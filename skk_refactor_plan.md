# SKK実装 改装計画

## 1. 状態管理の導入 (`kana_ime.h`)

-   現在の `ImeMode` に加えて、「ひらがな入力中」「変換候補選択中」「英数入力中」といった、より詳細な **状態** を定義します。これを `ImeState` とします。
-   `kana_ime.cpp` の全体的な処理を、この `ImeState` に基づいて切り替えるように変更します。

## 2. 入力処理の分離 (`kana_ime.cpp`)

-   キー入力を受け付ける部分を独立させます。
-   `a` や `k` などの文字入力は「文字バッファ」に溜めていきます。
-   `SPACE` や `ENTER`、矢印キーなどの特殊なキーが押されたら、新しい「司令塔」に「イベント」として通知する形にします。

## 3. ローマ字かな変換の整理 (`kana_ime.cpp`)

-   現在のローマ字かな変換ロジックは、SKKの変換処理と密接に結びついています。これを、単純に「文字バッファ」の中身をひらがなに変換する、というシンプルな機能に整理します。

## 4. SKK処理の明確化 (`skk.cpp`, `kana_ime.cpp`)

-   `kana_ime.cpp` にあるSKK候補を扱う処理（候補の追加や選択など）を、`skk.cpp` 側にカプセル化するか、新しく作る `KanjiConverter` のようなクラスにまとめます。
-   `skk.cpp` は、純粋に「かな文字列を受け取って、候補リストを返す」という役割に徹するようにします。

## 5. 表示処理の分離 (`draw_font.c`, `kana_ime.cpp`)

-   `kana_ime.cpp` の中にある描画関連のコードを、`draw_font.c` を使う「表示担当」の関数群としてまとめます。「司令塔」は、この関数を呼び出して画面を更新するだけ、という形を目指します。
